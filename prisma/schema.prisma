generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Service {
  id              String        @id @default(uuid())
  name            String
  durationMinutes Int
  price           Float
  category        String?
  createdAt       DateTime      @default(now())

  appointments    Appointment[]
  staffServices   StaffService[]
}

model Staff {
  id           String         @id @default(uuid())
  name         String
  role         String?
  active       Boolean        @default(true)
  createdAt    DateTime       @default(now())

  appointments  Appointment[]
  workingHours  WorkingHours[]
  staffServices StaffService[]
}

model StaffService {
  id        String   @id @default(uuid())
  staff     Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  staffId   String
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId String
  createdAt DateTime @default(now())

  @@unique([staffId, serviceId])
}

model Customer {
  id           String        @id @default(uuid())
  email        String        @unique
  name         String
  phone        String?
  noShowCount  Int           @default(0)
  isBlocked    Boolean       @default(false)
  blockedAt    DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  appointments Appointment[]
}

model WorkingHours {
  id         String   @id @default(uuid())
  staff      Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  staffId    String
  dayOfWeek  Int
  startTime  String
  endTime    String
  isWorking  Boolean  @default(true)

  @@unique([staffId, dayOfWeek])
}

model Appointment {
  id             String     @id @default(uuid())

  service        Service    @relation(fields: [serviceId], references: [id])
  serviceId      String

  staff          Staff      @relation(fields: [staffId], references: [id])
  staffId        String

  customer       Customer?  @relation(fields: [customerId], references: [id])
  customerId     String?

  customerName   String
  customerPhone  String
  customerEmail  String

  startTime      DateTime
  endTime        DateTime
  status         String     @default("booked")
  manageToken    String?
  createdAt      DateTime   @default(now())
}

model Settings {
  id                    String   @id @default("default")
  salonName             String   @default("Hera Nail Spa")
  salonPhone            String   @default("020 1234 5678")
  salonAddress          String   @default("123 Example Street, London, SW11 1AA")
  cancelMinutesAdvance  Int      @default(1440)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}
